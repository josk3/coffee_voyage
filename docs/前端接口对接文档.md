# 前端接口对接文档

## 基础配置

### 环境配置

```javascript
// 在 src/utils/request.js 中配置
const BASE_URL = 'http://localhost:3000/api'; // 开发环境
// const BASE_URL = 'https://api.example.com'; // 生产环境
```

### 请求封装

所有请求都通过 `request.js` 进行封装，支持以下方法：

```javascript
import request from '@/utils/request';

// GET请求
request.get(url, data, header);

// POST请求
request.post(url, data, header);

// PUT请求
request.put(url, data, header);

// DELETE请求
request.delete(url, data, header);
```

### 请求头配置

所有请求默认添加以下请求头：

```javascript
{
  'Content-Type': 'application/json',
  'Authorization': 'Bearer ${token}' // 登录后自动添加
}
```

## API 模块说明

所有API都通过 `src/api/index.js` 统一导出，按功能模块分类：

```javascript
import { 
  authAPI,      // 认证相关
  userAPI,      // 用户相关
  bannerAPI,    // 轮播图相关
  categoryAPI,  // 分类相关
  albumAPI,     // 专辑相关
  courseAPI,    // 课程相关
  commentAPI,   // 评论相关
  coffeeShopAPI // 咖啡店相关
} from '@/api';
```

## 认证相关接口

### 用户注册

```javascript
// 调用示例
const registerData = {
  username: 'test_user',
  password: '123456',
  email: 'test@example.com'
};

try {
  const result = await authAPI.register(registerData);
  console.log('注册成功', result);
} catch (error) {
  console.error('注册失败', error);
}
```

### 用户登录

```javascript
// 调用示例
const loginData = {
  username: 'test_user',
  password: '123456'
};

try {
  const result = await authAPI.login(loginData);
  // 登录成功后会自动保存token
  console.log('登录成功', result);
} catch (error) {
  console.error('登录失败', error);
}
```

### 微信快捷登录

```javascript
// 调用示例
const wxLoginData = {
  code: '微信返回的code',
  phoneCode: '获取手机号的授权code', // 可选
  userInfo: { // 可选
    nickName: '微信用户',
    avatarUrl: '头像URL',
    gender: 1
  }
};

try {
  const result = await authAPI.wxLogin(wxLoginData);
  console.log('微信登录成功', result);
} catch (error) {
  console.error('微信登录失败', error);
}
```

### 获取当前用户信息

```javascript
// 调用示例
try {
  const userInfo = await authAPI.getCurrentUser();
  console.log('用户信息', userInfo);
} catch (error) {
  console.error('获取用户信息失败', error);
}
```

## 用户相关接口

### 获取所有用户

```javascript
// 调用示例
const params = {
  page: 1,
  limit: 10
};

try {
  const result = await userAPI.getAllUsers(params);
  console.log('用户列表', result);
} catch (error) {
  console.error('获取用户列表失败', error);
}
```

### 获取单个用户

```javascript
// 调用示例
const userId = 'user_12345';

try {
  const userInfo = await userAPI.getUser(userId);
  console.log('用户详情', userInfo);
} catch (error) {
  console.error('获取用户详情失败', error);
}
```

### 更新用户信息

```javascript
// 调用示例
const userId = 'user_12345';
const updateData = {
  nickName: '新昵称',
  avatarUrl: '新头像URL',
  gender: 1
};

try {
  const result = await userAPI.updateUser(userId, updateData);
  console.log('更新成功', result);
} catch (error) {
  console.error('更新失败', error);
}
```

## 轮播图相关接口

### 获取轮播图列表

```javascript
// 调用示例
const params = {
  limit: 5
};

try {
  const banners = await bannerAPI.getBanners(params);
  console.log('轮播图列表', banners);
} catch (error) {
  console.error('获取轮播图失败', error);
}
```

## 分类相关接口

### 获取所有分类

```javascript
// 调用示例
try {
  const categories = await categoryAPI.getAllCategories();
  console.log('分类列表', categories);
} catch (error) {
  console.error('获取分类失败', error);
}
```

### 获取分类详情

```javascript
// 调用示例
const categoryId = 'cate_12345';

try {
  const category = await categoryAPI.getCategory(categoryId);
  console.log('分类详情', category);
} catch (error) {
  console.error('获取分类详情失败', error);
}
```

## 专辑相关接口

### 获取推荐专辑

```javascript
// 调用示例
const params = {
  limit: 4
};

try {
  const albums = await albumAPI.getFeaturedAlbums(params);
  console.log('推荐专辑', albums);
} catch (error) {
  console.error('获取推荐专辑失败', error);
}
```

### 获取专辑详情

```javascript
// 调用示例
const albumId = 'album_12345';

try {
  const album = await albumAPI.getAlbum(albumId);
  console.log('专辑详情', album);
} catch (error) {
  console.error('获取专辑详情失败', error);
}
```

## 课程相关接口

### 获取推荐课程

```javascript
// 调用示例
const params = {
  limit: 6
};

try {
  const courses = await courseAPI.getFeaturedCourses(params);
  console.log('推荐课程', courses);
} catch (error) {
  console.error('获取推荐课程失败', error);
}
```

### 获取课程详情

```javascript
// 调用示例
const courseId = 'course_12345';

try {
  const course = await courseAPI.getCourse(courseId);
  console.log('课程详情', course);
} catch (error) {
  console.error('获取课程详情失败', error);
}
```

### 搜索课程

```javascript
// 调用示例
const params = {
  keyword: '咖啡豆',
  page: 1,
  limit: 10
};

try {
  const result = await courseAPI.searchCourses(params);
  console.log('搜索结果', result);
} catch (error) {
  console.error('搜索失败', error);
}
```

## 评论相关接口

### 获取课程评论

```javascript
// 调用示例
const courseId = 'course_12345';
const params = {
  page: 1,
  limit: 10
};

try {
  const comments = await commentAPI.getCourseComments(courseId, params);
  console.log('课程评论', comments);
} catch (error) {
  console.error('获取评论失败', error);
}
```

### 添加评论

```javascript
// 调用示例
const courseId = 'course_12345';
const commentData = {
  content: '课程很棒！',
  rating: 5
};

try {
  const result = await commentAPI.addComment(courseId, commentData);
  console.log('评论成功', result);
} catch (error) {
  console.error('评论失败', error);
}
```

## 咖啡店相关接口

### 获取咖啡店列表

```javascript
// 调用示例
const params = {
  page: 1,
  limit: 10
};

try {
  const shops = await coffeeShopAPI.getCoffeeShops(params);
  console.log('咖啡店列表', shops);
} catch (error) {
  console.error('获取咖啡店列表失败', error);
}
```

### 获取咖啡店详情

```javascript
// 调用示例
const shopId = 'shop_12345';

try {
  const shop = await coffeeShopAPI.getCoffeeShop(shopId);
  console.log('咖啡店详情', shop);
} catch (error) {
  console.error('获取咖啡店详情失败', error);
}
```

### 添加咖啡店评论

```javascript
// 调用示例
const shopId = 'shop_12345';
const reviewData = {
  content: '环境很好，咖啡也很棒！',
  rating: 5,
  images: [
    'https://example.com/review1.jpg',
    'https://example.com/review2.jpg'
  ]
};

try {
  const result = await coffeeShopAPI.addCoffeeShopReview(shopId, reviewData);
  console.log('评论成功', result);
} catch (error) {
  console.error('评论失败', error);
}
```

## 错误处理

所有接口调用都应该进行错误处理：

```javascript
try {
  const result = await someAPI.someMethod(params);
  // 处理成功结果
} catch (error) {
  // 处理错误
  console.error('操作失败', error);
  
  // 可以根据错误码进行不同处理
  if (error.code === 401) {
    // 未授权，跳转到登录页
    uni.navigateTo({
      url: '/pages/login/index'
    });
  } else {
    // 显示错误提示
    uni.showToast({
      title: error.message || '操作失败',
      icon: 'none'
    });
  }
}
```

## 注意事项

1. 所有接口调用都需要进行错误处理
2. 需要登录的接口会自动添加 token，无需手动处理
3. 文件上传接口需要特殊处理，建议使用 uni.uploadFile
4. 分页接口的页码从 1 开始
5. 图片上传建议使用 CDN 地址
6. 建议在请求时添加 loading 提示
7. 建议对频繁调用的接口添加缓存机制

## 示例代码

### 带 loading 的请求示例

```javascript
async function fetchData() {
  uni.showLoading({
    title: '加载中...',
    mask: true
  });
  
  try {
    const result = await someAPI.someMethod();
    // 处理结果
  } catch (error) {
    // 处理错误
  } finally {
    uni.hideLoading();
  }
}
```

### 带缓存的请求示例

```javascript
async function getCachedData() {
  const cacheKey = 'some_cache_key';
  const cacheData = uni.getStorageSync(cacheKey);
  
  if (cacheData) {
    return cacheData;
  }
  
  try {
    const result = await someAPI.someMethod();
    // 缓存数据，有效期1小时
    uni.setStorageSync(cacheKey, {
      data: result,
      timestamp: Date.now() + 3600000
    });
    return result;
  } catch (error) {
    throw error;
  }
}
```

### 文件上传示例

```javascript
async function uploadFile(filePath) {
  uni.showLoading({
    title: '上传中...',
    mask: true
  });
  
  try {
    const result = await uni.uploadFile({
      url: `${BASE_URL}/upload`,
      filePath: filePath,
      name: 'file',
      header: {
        'Authorization': `Bearer ${uni.getStorageSync('token')}`
      }
    });
    
    const data = JSON.parse(result.data);
    return data;
  } catch (error) {
    throw error;
  } finally {
    uni.hideLoading();
  }
}
``` 